<!DOCTYPE html>
<html>
    <head>
        <title>Employee DEMO</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <!-- External files -->

        <!-- JQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!-- Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

        <!-- Datatables -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.24/datatables.min.css"/>
        <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.24/datatables.min.js"></script>
        
        <!-- Bootstrap Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    </head>
    <header>
        <div class="pos-f-t">
            <div class="p-4" style="background-color: #7AC4A4;">
                <h5 class="text-white h1">Employee DEMO</h5>
                <span class="text-muted h4">GFT Intership 2021</span>
            </div>
        </div>
    </header>
    <body>
        <div class='container' style='padding-top: 20px;'>
            <div class="card mb-3 border-secondary">
                <div class="p-3 mb-2 text-white" style='border-radius: 3px; background-color: #94bca2;'>
                    <h3 class="text-center">Employee Management</h3>
                </div>
                <div class="card-body">
                    <table class='table' id='table'>
                        <thead class="bg-secondary text-white text-center">
                            <tr>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th><button class="btn" style="background-color: #A8E58E;" id="addNewBtn"><i class="bi bi-plus-lg"></i> Add New</button></th>
                                <th><button class="btn" style="background-color: pink;" id="deleteAllBtn"><i class="bi bi-trash"></i> Delete All</button></th>
                            </tr>
                        </thead>
                        <tbody id="tbody" class='text-center'>
                        </tbody>
                    </table>
                </div>
            </div>
            <!--------------------- Alerts --------------------->
            <div class="alert alert-success alert-dismissible fade show text-center" role="alert" id="alertDiv" style="display: none;">
                <label id="alertLabel"><strong>This is an alert</strong></label>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="alert alert-danger alert-dismissible fade show text-center" role="alert" id="alertErrorDiv" style="display: none;">
                <label id="alertErrorLabel"><strong>This is an alert</strong></label>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <!--------------------- Modal --------------------->
            <div class="modal fade" tabindex="-1" id='editModal'>
                <div class="modal-dialog modal-dialog-centered $modal-fade-transform: scale(.8)">
                    <div class="modal-content">
                        <div class="modal-header" style="display: flex; align-content: center; background-color: #94bca2">
                            <div class="container-fluid">
                                <h3 class="modal-title" id='modalTitle' style='text-align: center'>Edit Employee</h3>
                            </div>
                        </div>
                        <div class="modal-body">
                            <form id='modaltForm'>
                                <div class="container-fluid" style='align-items: center'>
                                    <div class="row justify-content-md-center">
                                        <div class="col-md-8">
                                            <label class="h4">First Name:</label>
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" id="nameFld" placeholder="First Name">
                                            </div>
                                            <label id="nameErrorLabel" style="display: none; color: red;">Error</label>
                                        </div>
                                    </div>
                                    <div class="row justify-content-md-center">
                                        <div class="col-md-8">
                                            <label class="h4">Last Name:</label>
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" id="lastNameFld" placeholder="Last Name">
                                            </div>
                                            <label id="lastNameErrorLabel" style="display: none; color: red;">Error</label>
                                        </div>
                                    </div>
                                    <div class="row justify-content-md-center">
                                        <div class="col-md-8">
                                            <label class="h4">Email:</label>
                                            <div class="input-group mb-3">
                                                <input type="text" class="form-control" id="emailFld" required placeholder='Email'>
                                            </div>
                                            <label id="emailErrorLabel" style="display: none; color: red;">Error</label>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <div class="container-fluid" style='align-items: center'>
                                <div class="row justify-content-around">
                                    <button type="button" class="btn btn-secondary col-md-5" data-dismiss="modal">Cancel</button>
                                    <button type="button" id="confirmBtn" class="btn col-md-5 text-white" style="background-color: #A395CD;">Save</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </body>
    <footer class="text-center text-white" style="position: absolute; width: 100%; bottom: 0;background-color: #7AC4A4;">
        <div class="container p-4 pb-0">
            <!-- Section: CTA -->
            <section class="">
                <p class="d-flex justify-content-center align-items-center">
                    <span class="me-3 h4">Made by: Joy Bonilla</span>
                </p>
            </section>
            <section class="">
                <p class="d-flex justify-content-center align-items-center">
                    <span class="me-3 h3">2021</span>
                </p>
            </section>
            <!-- Section: CTA -->
        </div>
    </footer>
    <script>
        var emailRegex = /^(\w|[!#$%&'*+/=?^_`{|}~+-\[\]])+(\.(\w[!#$%&'*+/=?^_`{|}~+-\[\]]))*\@\w+(\.\w{2,4})+$/;
        var employees = [];
        function init() {
            
            selectAll();
            
            $("#addNewBtn").on("click", ()=>{ addNew(); });
            $("#deleteAllBtn").on("click", ()=>{ removeAll()(); });
        }
        function selectAll() {
            $.ajax({
                url: "ServletEmployee/selectAll",
                method: "POST"
            }).then(
                (list) => { //Exito
                    rowEmployees(JSON.parse(list));
                    employees = JSON.parse(list);
                    $("#table").DataTable({ lengthMenu: [5, 10, 20, 30] });
            },
                    () => { //Error
                report("Error on SelectAll");
            }
            );
            
        }
        function insert() {
            var user = {"name": $("#nameFld").val(), "lastName": $("#lastNameFld").val(), "email": $("#emailFld").val()}
            $.ajax({
                url: "ServletEmployee/insert",
                data: JSON.stringify(user),
                method: "POST"
            }).then(
                    () => { //Exito
                location.reload();
            },
                    () => { //Error
                reportError("Error on Insert")
            }
            );
        }
        function rowEmployees(list) {
            $("#tbody").html("");
            for (var i = 0; i < list.length; i++) {
                var tr = $("<tr/>");
                tr.html(
                        "<td>" + list[i].name + " " + list[i].lastName + "</td>" +
                        "<td>" + list[i].email + "</td>" +
                        "<td><button class='btn' style='background-color: #FFF09E;' onclick=edit("+i+")><i class='bi bi-pencil-square'></i> Edit</button></td>" +
                        "<td><button class='btn' style='background-color: pink;' onclick=remove("+i+")><i class='bi bi-trash'></i> Delete</button></td>"
                        );
                $("#tbody").append(tr);
            }
        }
        function addNew(){
            $("#modalTitle").html("Add Employee");
            $("#confirmBtn").on("click", ()=>{ validateNew(); });
            
            $("#nameFld").val("");
            $("#lastNameFld").val("");
            $("#emailFld").val("");
            
            $("#editModal").modal("show");
        }
        function edit(num){
            $("#modalTitle").html("Edit Employee");
            $("#confirmBtn").on("click", ()=>{ validateEdit(num); });
            
            $("#nameFld").val(employees[num].name);
            $("#lastNameFld").val(employees[num].lastName);
            $("#emailFld").val(employees[num].email);
            
            $("#editModal").modal("show");
        }
        function remove(num){
            $.ajax({
                url: "ServletEmployee/delete",
                data: {"index": num.toString()},
                method: "POST"
            }).then(
                () => { //Exito
                    location.reload();
            },
                    () => { //Error
                report("Error on SelectAll");
            }
            );
        }
        function removeAll(){
            $.ajax({
                url: "ServletEmployee/deleteAll",
                method: "POST"
            }).then(
                () => { //Exito
                    location.reload();
            },
                    () => { //Error
                report("Error on SelectAll");
            }
            );
        }
        function update(num){
            $.ajax({
                url: "ServletEmployee/update",
                data: {"index": num.toString(), "name":$("#nameFld").val(), "lastName":$("#lastNameFld").val(), "email":$("#emailFld").val()},
                method: "POST"
            }).then(
                () => { //Exito
                    location.reload();
            },
                    () => { //Error
                report("Error on SelectAll");
            }
            );
        }
        function validateNew(){
            var flag = true;
            if($("#nameFld").val() == ""){
                $("#nameFld").css("background-color", "pink");
                $("#nameErrorLabel").html("Name Field Required");
                $("#nameErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#nameFld").css("background-color", "white");
                $("#nameErrorLabel").css("display", "none");
            }
            if($("#lastNameFld").val() == ""){
                $("#lastNameFld").css("background-color", "pink");
                $("#lastNameErrorLabel").html("Last Name Field Required");
                $("#lastNameErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#lastNameFld").css("background-color", "white");
                $("#lastNameErrorLabel").css("display", "none");
            }
            if($("#emailFld").val() == "" || !emailRegex.test($("#emailFld").val())){
                $("#emailFld").css("background-color", "pink");
                $("#emailErrorLabel").html("Invalid Email");
                $("#emailErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#emailFld").css("background-color", "white");
                $("#emailErrorLabel").css("display", "none");
            }
            if(flag){
                insert();
            }
        }
        function validateEdit(num){
            var flag = true;
            if($("#nameFld").val() == ""){
                console.log("no name");
                $("#nameFld").css("background-color", "pink");
                $("#nameErrorLabel").html("Name Field Required");
                $("#nameErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#nameFld").css("background-color", "white");
                $("#nameErrorLabel").css("display", "none");
            }
            if($("#lastNameFld").val() == ""){
                console.log("no lastname");
                $("#lastNameFld").css("background-color", "pink");
                $("#lastNameErrorLabel").html("Last Name Field Required");
                $("#lastNameErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#lastNameFld").css("background-color", "white");
                $("#lastNameErrorLabel").css("display", "none");
            }
            if($("#emailFld").val() == "" || !emailRegex.test($("#emailFld").val())){
                console.log("no email");
                $("#emailFld").css("background-color", "pink");
                $("#emailErrorLabel").html("Invalid Email");
                $("#emailErrorLabel").css("display", "");
                flag = false;
            }
            else{
                $("#emailFld").css("background-color", "white");
                $("#emailErrorLabel").css("display", "none");
            }
            if(flag){
                update(num);
            }
        }
        function report(alert){
            $("#alertLabel").html(alert);
            $("#alertDiv").show();
        }
        function reportError(alert){
            $("#alertErrorLabel").html(alert);
            $("#alertErrorDiv").show();
        }
        init();
    </script>
</html>
